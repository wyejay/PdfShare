
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>EduLibrary - PDF Manager</title>
<style>
  /* CSS Variables for theming */
  :root {
    --primary-color: #4f46e5;
    --primary-hover: #4338ca;
    --secondary-color: #6366f1;
    --background: #ffffff;
    --surface: #f8fafc;
    --surface-elevated: #ffffff;
    --text-primary: #1e293b;
    --text-secondary: #64748b;
    --text-muted: #94a3b8;
    --border: #e2e8f0;
    --border-hover: #cbd5e1;
    --success: #10b981;
    --error: #ef4444;
    --warning: #f59e0b;
    --shadow: rgba(0, 0, 0, 0.1);
    --shadow-lg: rgba(0, 0, 0, 0.15);
    --backdrop: rgba(0, 0, 0, 0.5);
  }

  [data-theme="dark"] {
    --primary-color: #6366f1;
    --primary-hover: #5b5bf6;
    --secondary-color: #8b5cf6;
    --background: #0f172a;
    --surface: #1e293b;
    --surface-elevated: #334155;
    --text-primary: #f1f5f9;
    --text-secondary: #cbd5e1;
    --text-muted: #94a3b8;
    --border: #334155;
    --border-hover: #475569;
    --success: #10b981;
    --error: #ef4444;
    --warning: #f59e0b;
    --shadow: rgba(0, 0, 0, 0.3);
    --shadow-lg: rgba(0, 0, 0, 0.4);
    --backdrop: rgba(0, 0, 0, 0.7);
  }

  /* Reset & base */
  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }
  
  body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    background: var(--background);
    color: var(--text-primary);
    display: flex;
    flex-direction: column;
    min-height: 100vh;
    transition: all 0.3s ease;
  }

  /* Header */
  header {
    background: var(--surface-elevated);
    border-bottom: 1px solid var(--border);
    padding: 1rem 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    position: sticky;
    top: 0;
    z-index: 100;
    backdrop-filter: blur(8px);
  }
  
  .logo {
    display: flex;
    align-items: center;
    gap: 12px;
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--primary-color);
  }
  
  .user-info {
    display: flex;
    align-items: center;
    gap: 16px;
    color: var(--text-secondary);
  }
  
  .user-stats {
    font-size: 0.875rem;
    background: var(--surface);
    padding: 8px 12px;
    border-radius: 20px;
    border: 1px solid var(--border);
    color: var(--text-secondary);
  }

  .settings-btn {
    background: none;
    border: none;
    color: var(--text-secondary);
    cursor: pointer;
    padding: 8px;
    border-radius: 8px;
    transition: all 0.2s;
  }

  .settings-btn:hover {
    background: var(--surface);
    color: var(--text-primary);
  }

  /* Navigation */
  nav {
    background: var(--surface-elevated);
    border-bottom: 1px solid var(--border);
    display: flex;
    justify-content: center;
    padding: 0;
  }
  
  nav button {
    background: none;
    border: none;
    color: var(--text-secondary);
    font-size: 0.95rem;
    font-weight: 500;
    padding: 1rem 2rem;
    cursor: pointer;
    transition: all 0.2s;
    position: relative;
    border-bottom: 2px solid transparent;
  }
  
  nav button.active,
  nav button:hover {
    color: var(--primary-color);
    border-bottom-color: var(--primary-color);
  }

  /* Container for sections */
  main {
    flex: 1;
    padding: 2rem;
    max-width: 1200px;
    margin: 0 auto;
    width: 100%;
  }
  
  section {
    background: var(--surface-elevated);
    border-radius: 16px;
    padding: 2rem;
    box-shadow: 0 1px 3px var(--shadow);
    border: 1px solid var(--border);
    display: none;
  }
  
  section.active {
    display: block;
    animation: fadeIn 0.3s ease;
  }
  
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(8px); }
    to { opacity: 1; transform: translateY(0); }
  }

  h1, h2 {
    margin-bottom: 1.5rem;
    color: var(--text-primary);
    display: flex;
    align-items: center;
    gap: 12px;
    font-weight: 600;
  }

  /* Auth forms */
  .auth-container {
    max-width: 420px;
    margin: 0 auto;
  }
  
  .auth-tabs {
    display: flex;
    margin-bottom: 2rem;
    background: var(--surface);
    border-radius: 12px;
    padding: 4px;
  }
  
  .auth-tab {
    flex: 1;
    padding: 12px 16px;
    background: none;
    border: none;
    cursor: pointer;
    font-size: 0.95rem;
    font-weight: 500;
    color: var(--text-secondary);
    border-radius: 8px;
    transition: all 0.2s;
  }
  
  .auth-tab.active {
    background: var(--primary-color);
    color: white;
    box-shadow: 0 2px 4px var(--shadow);
  }

  /* Forms */
  .form-group {
    margin-bottom: 1.5rem;
  }
  
  label {
    display: block;
    margin-bottom: 8px;
    font-weight: 500;
    color: var(--text-primary);
    font-size: 0.875rem;
  }
  
  input[type="text"], input[type="email"], input[type="password"], 
  input[type="file"], input[type="search"], select, textarea {
    width: 100%;
    padding: 12px 16px;
    border: 1px solid var(--border);
    border-radius: 10px;
    font-size: 0.95rem;
    background: var(--surface);
    color: var(--text-primary);
    transition: all 0.2s;
  }
  
  input:focus, select:focus, textarea:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
  }
  
  textarea {
    resize: vertical;
    height: 80px;
  }

  /* Buttons */
  .btn {
    background: var(--primary-color);
    border: none;
    padding: 12px 24px;
    color: white;
    font-size: 0.95rem;
    font-weight: 500;
    cursor: pointer;
    border-radius: 10px;
    transition: all 0.2s;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
  }
  
  .btn:hover {
    background: var(--primary-hover);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px var(--shadow-lg);
  }
  
  .btn.btn-full {
    width: 100%;
  }
  
  .btn.btn-secondary {
    background: var(--surface);
    color: var(--text-primary);
    border: 1px solid var(--border);
  }
  
  .btn.btn-secondary:hover {
    background: var(--border);
  }
  
  .btn.btn-danger {
    background: var(--error);
  }
  
  .btn.btn-warning {
    background: var(--warning);
  }

  /* Files section improvements */
  .files-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 2rem;
    gap: 1rem;
  }

  .files-title {
    margin: 0;
  }
  
  .files-controls {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    align-items: flex-end;
  }

  .category-filter {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    justify-content: flex-end;
  }
  
  .category-btn {
    padding: 8px 16px;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 20px;
    cursor: pointer;
    transition: all 0.2s;
    font-size: 0.875rem;
    color: var(--text-secondary);
    font-weight: 500;
  }
  
  .category-btn.active {
    background: var(--primary-color);
    color: white;
    border-color: var(--primary-color);
  }

  .category-btn:hover:not(.active) {
    background: var(--border);
    color: var(--text-primary);
  }

  .file-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 1.5rem;
    margin-top: 0;
  }
  
  .file-card {
    background: var(--surface);
    border-radius: 12px;
    padding: 1.5rem;
    border: 1px solid var(--border);
    transition: all 0.2s;
  }
  
  .file-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px var(--shadow-lg);
    border-color: var(--border-hover);
  }
  
  .file-header {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    margin-bottom: 1rem;
  }
  
  .file-icon {
    width: 40px;
    height: 40px;
    background: var(--error);
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 600;
    font-size: 0.75rem;
    flex-shrink: 0;
  }
  
  .file-info h3 {
    margin: 0 0 8px 0;
    font-size: 1.1rem;
    color: var(--text-primary);
    line-height: 1.4;
    font-weight: 600;
  }
  
  .file-meta {
    font-size: 0.8rem;
    color: var(--text-muted);
    line-height: 1.4;
  }
  
  .file-category {
    display: inline-block;
    background: var(--primary-color);
    color: white;
    padding: 4px 10px;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 500;
    margin-top: 8px;
  }
  
  .file-description {
    margin: 1rem 0;
    font-size: 0.9rem;
    color: var(--text-secondary);
    line-height: 1.5;
  }
  
  .file-actions {
    display: flex;
    gap: 8px;
    margin-top: 1rem;
  }
  
  .file-actions .btn {
    flex: 1;
    padding: 10px 12px;
    font-size: 0.85rem;
  }

  /* Settings Modal */
  .modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: var(--backdrop);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    padding: 1rem;
  }

  .modal-overlay.active {
    display: flex;
  }

  .modal {
    background: var(--surface-elevated);
    border-radius: 16px;
    padding: 2rem;
    max-width: 500px;
    width: 100%;
    max-height: 80vh;
    overflow-y: auto;
    border: 1px solid var(--border);
    box-shadow: 0 20px 40px var(--shadow-lg);
  }

  .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
  }

  .modal-header h2 {
    margin: 0;
  }

  .close-btn {
    background: none;
    border: none;
    font-size: 1.5rem;
    cursor: pointer;
    color: var(--text-secondary);
    padding: 4px;
    border-radius: 4px;
    transition: all 0.2s;
  }

  .close-btn:hover {
    background: var(--surface);
    color: var(--text-primary);
  }

  .setting-group {
    margin-bottom: 2rem;
    padding-bottom: 1.5rem;
    border-bottom: 1px solid var(--border);
  }

  .setting-group:last-child {
    border-bottom: none;
    margin-bottom: 0;
  }

  .setting-title {
    font-size: 1rem;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 0.5rem;
  }

  .setting-description {
    font-size: 0.875rem;
    color: var(--text-secondary);
    margin-bottom: 1rem;
  }

  .theme-selector {
    display: flex;
    gap: 1rem;
  }

  .theme-option {
    flex: 1;
    padding: 1rem;
    border: 2px solid var(--border);
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.2s;
    text-align: center;
    background: var(--surface);
  }

  .theme-option.selected {
    border-color: var(--primary-color);
    background: rgba(99, 102, 241, 0.1);
  }

  .theme-preview {
    width: 100%;
    height: 40px;
    border-radius: 8px;
    margin-bottom: 0.5rem;
  }

  .theme-preview.light {
    background: linear-gradient(135deg, #ffffff 50%, #f8fafc 50%);
    border: 1px solid #e2e8f0;
  }

  .theme-preview.dark {
    background: linear-gradient(135deg, #0f172a 50%, #1e293b 50%);
  }

  /* Invite Section */
  .invite-section {
    background: var(--surface);
    border-radius: 12px;
    padding: 1.5rem;
    border: 1px solid var(--border);
    margin-bottom: 2rem;
  }

  .invite-link {
    background: var(--surface-elevated);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 12px;
    font-family: monospace;
    font-size: 0.875rem;
    color: var(--text-secondary);
    word-break: break-all;
    margin: 1rem 0;
  }

  /* Progress bar */
  .progress-bar {
    width: 100%;
    height: 8px;
    background: var(--surface);
    border-radius: 10px;
    overflow: hidden;
    margin: 15px 0;
    display: none;
    border: 1px solid var(--border);
  }
  
  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
    width: 0%;
    transition: width 0.3s ease;
  }

  /* Status messages */
  .status-message {
    margin: 1rem 0;
    padding: 12px 16px;
    border-radius: 10px;
    text-align: center;
    font-weight: 500;
    border: 1px solid;
  }
  
  .status-success {
    background: rgba(16, 185, 129, 0.1);
    color: var(--success);
    border-color: var(--success);
  }
  
  .status-error {
    background: rgba(239, 68, 68, 0.1);
    color: var(--error);
    border-color: var(--error);
  }

  .empty-state {
    text-align: center;
    padding: 3rem 1rem;
    color: var(--text-muted);
  }
  
  .empty-state .icon {
    font-size: 4rem;
    margin-bottom: 1rem;
    opacity: 0.5;
  }

  /* Support Section */
  .support-section {
    background: var(--surface);
    border-radius: 12px;
    padding: 1.5rem;
    border: 1px solid var(--border);
    margin-bottom: 2rem;
  }

  .ticket-card {
    background: var(--surface-elevated);
    border-radius: 8px;
    padding: 1rem;
    border: 1px solid var(--border);
    margin-bottom: 1rem;
  }

  .ticket-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 0.5rem;
  }

  .ticket-status {
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 600;
  }

  .ticket-status.open { background: var(--warning); color: white; }
  .ticket-status.in-progress { background: var(--primary-color); color: white; }
  .ticket-status.resolved { background: var(--success); color: white; }

  .ticket-priority {
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 600;
    margin-left: 8px;
  }

  .ticket-priority.low { background: var(--surface); color: var(--text-secondary); }
  .ticket-priority.medium { background: var(--warning); color: white; }
  .ticket-priority.high { background: var(--error); color: white; }
  .ticket-priority.urgent { background: #dc2626; color: white; }

  /* Admin Panel */
  .admin-tabs {
    display: flex;
    margin-bottom: 2rem;
    background: var(--surface);
    border-radius: 12px;
    padding: 4px;
    gap: 4px;
  }

  .admin-tab {
    flex: 1;
    padding: 12px 16px;
    background: none;
    border: none;
    cursor: pointer;
    font-size: 0.95rem;
    font-weight: 500;
    color: var(--text-secondary);
    border-radius: 8px;
    transition: all 0.2s;
  }

  .admin-tab.active {
    background: var(--primary-color);
    color: white;
  }

  .admin-content {
    background: var(--surface);
    border-radius: 12px;
    padding: 1.5rem;
    border: 1px solid var(--border);
  }

  .user-card, .admin-file-card {
    background: var(--surface-elevated);
    border-radius: 8px;
    padding: 1rem;
    border: 1px solid var(--border);
    margin-bottom: 1rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .user-info h4 {
    margin: 0 0 4px 0;
    color: var(--text-primary);
  }

  .user-meta {
    font-size: 0.875rem;
    color: var(--text-secondary);
  }

  .user-actions {
    display: flex;
    gap: 8px;
  }

  .analytics-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin-bottom: 2rem;
  }

  .stat-card {
    background: var(--surface-elevated);
    border-radius: 12px;
    padding: 1.5rem;
    text-align: center;
    border: 1px solid var(--border);
  }

  .stat-number {
    font-size: 2rem;
    font-weight: 700;
    color: var(--primary-color);
    margin-bottom: 0.5rem;
  }

  .stat-label {
    color: var(--text-secondary);
    font-size: 0.875rem;
  }

  .featured-badge {
    background: linear-gradient(45deg, #ffd700, #ffed4e);
    color: #1a1a1a;
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 600;
    margin-left: 8px;
  }

  /* Responsive */
  @media (max-width: 768px) {
    header {
      padding: 1rem;
      flex-direction: column;
      gap: 1rem;
    }
    
    main {
      padding: 1rem;
    }
    
    section {
      padding: 1.5rem;
    }
    
    .file-grid {
      grid-template-columns: 1fr;
    }
    
    .files-header {
      flex-direction: column;
      align-items: stretch;
    }

    .files-controls {
      align-items: stretch;
    }

    .category-filter {
      justify-content: flex-start;
    }
    
    nav button {
      padding: 0.75rem 1rem;
      font-size: 0.875rem;
    }

    .modal {
      margin: 1rem;
      padding: 1.5rem;
    }

    .theme-selector {
      flex-direction: column;
    }
  }
</style>
</head>
<body>

<header>
  <div class="logo">
    📚 EduLibrary
  </div>
  <div class="user-info" id="userInfo">
    <div id="authButtons">
      <button class="btn" onclick="showAuthModal()">Login / Register</button>
    </div>
  </div>
</header>

<nav id="mainNav" style="display: none;">
  <button class="active" data-section="browse">Browse Library</button>
  <button data-section="upload">Upload PDF</button>
  <button data-section="search">Search PDFs</button>
  <button data-section="invite">Invite Friends</button>
  <button data-section="support">Support</button>
  <button id="adminNavBtn" data-section="admin" style="display: none;">Admin Panel</button>
</nav>

<main>
  <!-- Auth Section -->
  <section id="auth" class="active">
    <div class="auth-container">
      <h1>Welcome to EduLibrary</h1>
      <p style="text-align: center; color: var(--text-secondary); margin-bottom: 2rem;">
        Your digital library for educational and reference materials
      </p>
      
      <div class="auth-tabs">
        <button class="auth-tab active" onclick="switchAuthTab('login')">Login</button>
        <button class="auth-tab" onclick="switchAuthTab('register')">Register</button>
      </div>
      
      <div id="loginForm">
        <form id="loginFormElement">
          <div class="form-group">
            <label for="loginUsername">Username or Email</label>
            <input type="text" id="loginUsername" required>
          </div>
          <div class="form-group">
            <label for="loginPassword">Password</label>
            <input type="password" id="loginPassword" required>
          </div>
          <button type="submit" class="btn btn-full">Login</button>
        </form>
      </div>
      
      <div id="registerForm" style="display: none;">
        <form id="registerFormElement">
          <div class="form-group">
            <label for="registerUsername">Username</label>
            <input type="text" id="registerUsername" required>
          </div>
          <div class="form-group">
            <label for="registerEmail">Email</label>
            <input type="email" id="registerEmail" required>
          </div>
          <div class="form-group">
            <label for="registerPassword">Password</label>
            <input type="password" id="registerPassword" required>
          </div>
          <button type="submit" class="btn btn-full">Register</button>
        </form>
      </div>
      
      <div id="authStatus"></div>
    </div>
  </section>

  <!-- Browse Section -->
  <section id="browse">
    <div class="files-header">
      <h1 class="files-title">📚 Library Collection</h1>
      <div class="files-controls">
        <div class="category-filter">
          <button class="category-btn active" data-category="all">All</button>
        </div>
      </div>
    </div>
    <div class="file-grid" id="fileGrid"></div>
  </section>

  <!-- Upload Section -->
  <section id="upload">
    <h1>📤 Upload PDF</h1>
    <form id="uploadForm">
      <div class="form-group">
        <label for="pdfFile">Select PDF File(s)</label>
        <input type="file" id="pdfFile" accept="application/pdf" multiple />
      </div>
      
      <div class="form-group">
        <label for="category">Category</label>
        <select id="category" required>
          <option value="">Select a category</option>
        </select>
      </div>
      
      <div class="form-group">
        <label for="description">Description (Optional)</label>
        <textarea id="description" placeholder="Brief description of the PDF content..."></textarea>
      </div>
      
      <div class="form-group">
        <label for="tags">Tags (Optional)</label>
        <input type="text" id="tags" placeholder="research, academic, tutorial (comma-separated)">
      </div>
      
      <div class="progress-bar">
        <div class="progress-fill"></div>
      </div>
      
      <button type="submit" class="btn btn-full">Upload PDF(s)</button>
    </form>
    <div id="uploadStatus"></div>
  </section>

  <!-- Search Section -->
  <section id="search">
    <h1>🔍 Search PDFs</h1>
    <div class="form-group">
      <input type="search" id="searchInput" placeholder="Search by title, category, or description..." />
    </div>
    <div class="file-grid" id="searchResults"></div>
  </section>

  <!-- Invite Section -->
  <section id="invite">
    <h1>👥 Invite Friends</h1>
    
    <div class="invite-section">
      <div class="setting-title">Share EduLibrary</div>
      <div class="setting-description">
        Invite your friends to join EduLibrary and build a collaborative learning community.
      </div>
      
      <div class="form-group">
        <label>Your Invite Link</label>
        <div class="invite-link" id="inviteLink">Loading...</div>
        <button class="btn" onclick="copyInviteLink()">📋 Copy Link</button>
      </div>
    </div>

    <div class="invite-section">
      <div class="setting-title">Invite by Email</div>
      <div class="setting-description">
        Send a personal invitation to your friends via email.
      </div>
      
      <form id="inviteForm">
        <div class="form-group">
          <label for="inviteEmail">Friend's Email</label>
          <input type="email" id="inviteEmail" required placeholder="friend@example.com">
        </div>
        <div class="form-group">
          <label for="inviteMessage">Personal Message (Optional)</label>
          <textarea id="inviteMessage" placeholder="Hey! I found this great PDF library that I think you'd love..."></textarea>
        </div>
        <button type="submit" class="btn btn-full">Send Invitation</button>
      </form>
      <div id="inviteStatus"></div>
    </div>
  </section>

  <!-- Support Section -->
  <section id="support">
    <h1>🛟 Customer Support</h1>
    
    <div class="support-section">
      <div class="setting-title">Need Help?</div>
      <div class="setting-description">
        Submit a support ticket and our team will get back to you as soon as possible.
      </div>
      
      <form id="supportForm">
        <div class="form-group">
          <label for="supportTitle">Issue Title</label>
          <input type="text" id="supportTitle" required placeholder="Brief description of your issue">
        </div>
        <div class="form-group">
          <label for="supportPriority">Priority</label>
          <select id="supportPriority" required>
            <option value="low">Low</option>
            <option value="medium" selected>Medium</option>
            <option value="high">High</option>
            <option value="urgent">Urgent</option>
          </select>
        </div>
        <div class="form-group">
          <label for="supportDescription">Description</label>
          <textarea id="supportDescription" required placeholder="Please describe your issue in detail..." rows="5"></textarea>
        </div>
        <button type="submit" class="btn btn-full">Submit Ticket</button>
      </form>
      <div id="supportStatus"></div>
    </div>

    <div class="support-section">
      <div class="setting-title">My Support Tickets</div>
      <div id="supportTickets">Loading...</div>
    </div>
  </section>

  <!-- Admin Panel -->
  <section id="admin">
    <h1>⚙️ Admin Panel</h1>
    
    <div class="admin-tabs">
      <button class="admin-tab active" onclick="switchAdminTab('users')">User Management</button>
      <button class="admin-tab" onclick="switchAdminTab('files')">File Management</button>
      <button class="admin-tab" onclick="switchAdminTab('support')">Support Tickets</button>
      <button class="admin-tab" onclick="switchAdminTab('analytics')">Analytics</button>
    </div>

    <div id="adminUsers" class="admin-content">
      <h2>User Management</h2>
      <div id="usersList">Loading...</div>
    </div>

    <div id="adminFiles" class="admin-content" style="display: none;">
      <h2>File Management</h2>
      <div class="form-group">
        <button class="btn" onclick="loadFeaturedFiles()">Manage Featured Files</button>
      </div>
      <div id="adminFilesList">Loading...</div>
    </div>

    <div id="adminSupport" class="admin-content" style="display: none;">
      <h2>Support Ticket Management</h2>
      <div id="adminTicketsList">Loading...</div>
    </div>

    <div id="adminAnalytics" class="admin-content" style="display: none;">
      <h2>Analytics Dashboard</h2>
      <div id="analyticsData">Loading...</div>
    </div>
  </section>
</main>

<!-- Settings Modal -->
<div class="modal-overlay" id="settingsModal">
  <div class="modal">
    <div class="modal-header">
      <h2>⚙️ Settings</h2>
      <button class="close-btn" onclick="closeSettings()">&times;</button>
    </div>
    
    <div class="setting-group">
      <div class="setting-title">Theme</div>
      <div class="setting-description">Choose your preferred color scheme</div>
      <div class="theme-selector">
        <div class="theme-option" data-theme="light" onclick="setTheme('light')">
          <div class="theme-preview light"></div>
          <div>Light Mode</div>
        </div>
        <div class="theme-option selected" data-theme="dark" onclick="setTheme('dark')">
          <div class="theme-preview dark"></div>
          <div>Dark Mode</div>
        </div>
      </div>
    </div>

    <div class="setting-group">
      <div class="setting-title">File Grid Layout</div>
      <div class="setting-description">Adjust how files are displayed</div>
      <div class="form-group">
        <label for="gridSize">Cards per row</label>
        <select id="gridSize" onchange="updateGridSize(this.value)">
          <option value="auto">Auto (Responsive)</option>
          <option value="1">1 Column</option>
          <option value="2">2 Columns</option>
          <option value="3">3 Columns</option>
          <option value="4">4 Columns</option>
        </select>
      </div>
    </div>

    <div class="setting-group">
      <div class="setting-title">Upload Preferences</div>
      <div class="setting-description">Default settings for new uploads</div>
      <div class="form-group">
        <label for="defaultCategory">Default Category</label>
        <select id="defaultCategory">
          <option value="">No Default</option>
        </select>
      </div>
    </div>

    <div class="setting-group">
      <div class="setting-title">Privacy</div>
      <div class="setting-description">Control your data and visibility</div>
      <div class="form-group">
        <label>
          <input type="checkbox" id="showInLeaderboard" checked> 
          Show my activity in community stats
        </label>
      </div>
    </div>

    <div class="setting-group">
      <button class="btn btn-danger btn-full" onclick="exportData()">
        📥 Export My Data
      </button>
    </div>
  </div>
</div>

<script>
  // Global variables
  let currentUser = null;
  let allFiles = [];
  let categories = [];
  let currentCategory = 'all';
  let currentTheme = localStorage.getItem('theme') || 'light';
  let gridSize = localStorage.getItem('gridSize') || 'auto';

  // Elements
  const authSection = document.getElementById('auth');
  const mainNav = document.getElementById('mainNav');
  const userInfo = document.getElementById('userInfo');
  const fileGrid = document.getElementById('fileGrid');
  const searchResults = document.getElementById('searchResults');
  const uploadForm = document.getElementById('uploadForm');
  const categorySelect = document.getElementById('category');
  const progressBar = document.querySelector('.progress-bar');
  const progressFill = document.querySelector('.progress-fill');
  const settingsModal = document.getElementById('settingsModal');

  // Initialize app
  document.addEventListener('DOMContentLoaded', function() {
    initializeTheme();
    initializeGridSize();
    checkAuthStatus();
    setupEventListeners();
    generateInviteLink();
  });

  // Theme management
  function initializeTheme() {
    document.documentElement.setAttribute('data-theme', currentTheme);
    const themeOptions = document.querySelectorAll('.theme-option');
    themeOptions.forEach(option => {
      option.classList.toggle('selected', option.dataset.theme === currentTheme);
    });
  }

  function setTheme(theme) {
    currentTheme = theme;
    localStorage.setItem('theme', theme);
    document.documentElement.setAttribute('data-theme', theme);
    
    const themeOptions = document.querySelectorAll('.theme-option');
    themeOptions.forEach(option => {
      option.classList.toggle('selected', option.dataset.theme === theme);
    });
  }

  // Grid size management
  function initializeGridSize() {
    document.getElementById('gridSize').value = gridSize;
    updateGridSize(gridSize);
  }

  function updateGridSize(size) {
    gridSize = size;
    localStorage.setItem('gridSize', size);
    
    const grids = [fileGrid, searchResults];
    grids.forEach(grid => {
      if (size === 'auto') {
        grid.style.gridTemplateColumns = 'repeat(auto-fill, minmax(320px, 1fr))';
      } else {
        grid.style.gridTemplateColumns = `repeat(${size}, 1fr)`;
      }
    });
  }

  // Settings modal
  function openSettings() {
    settingsModal.classList.add('active');
    populateDefaultCategorySelect();
  }

  function closeSettings() {
    settingsModal.classList.remove('active');
  }

  function populateDefaultCategorySelect() {
    const defaultCategorySelect = document.getElementById('defaultCategory');
    defaultCategorySelect.innerHTML = '<option value="">No Default</option>';
    categories.forEach(category => {
      const option = document.createElement('option');
      option.value = category;
      option.textContent = category;
      defaultCategorySelect.appendChild(option);
    });
  }

  function exportData() {
    if (!currentUser) return;
    
    const userData = {
      user: currentUser,
      uploadedFiles: allFiles.filter(f => f.uploaded_by === currentUser.username),
      exportDate: new Date().toISOString()
    };
    
    const blob = new Blob([JSON.stringify(userData, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `edulibrary-data-${currentUser.username}.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  }

  // Generate invite link
  function generateInviteLink() {
    const baseUrl = window.location.origin;
    const inviteCode = currentUser ? btoa(currentUser.username) : 'general';
    const inviteUrl = `${baseUrl}?invite=${inviteCode}`;
    document.getElementById('inviteLink').textContent = inviteUrl;
  }

  function copyInviteLink() {
    const inviteLink = document.getElementById('inviteLink').textContent;
    navigator.clipboard.writeText(inviteLink).then(() => {
      showStatus('Invite link copied to clipboard!', 'success', 'inviteStatus');
    }).catch(() => {
      showStatus('Failed to copy link', 'error', 'inviteStatus');
    });
  }

  // Check if user is logged in
  async function checkAuthStatus() {
    try {
      const response = await fetch('/user-info');
      const data = await response.json();
      
      if (data.logged_in) {
        currentUser = data.user;
        showMainApp();
        loadFiles();
        generateInviteLink();
      } else {
        showAuthScreen();
      }
    } catch (error) {
      console.error('Auth check failed:', error);
      showAuthScreen();
    }
  }

  // Switch between auth tabs
  function switchAuthTab(tab) {
    const tabs = document.querySelectorAll('.auth-tab');
    const loginForm = document.getElementById('loginForm');
    const registerForm = document.getElementById('registerForm');
    
    tabs.forEach(t => t.classList.remove('active'));
    document.querySelector(`[onclick="switchAuthTab('${tab}')"]`).classList.add('active');
    
    if (tab === 'login') {
      loginForm.style.display = 'block';
      registerForm.style.display = 'none';
    } else {
      loginForm.style.display = 'none';
      registerForm.style.display = 'block';
    }
  }

  // Setup event listeners
  function setupEventListeners() {
    // Auth forms
    document.getElementById('loginFormElement').addEventListener('submit', handleLogin);
    document.getElementById('registerFormElement').addEventListener('submit', handleRegister);
    
    // Navigation
    document.querySelectorAll('nav button').forEach(button => {
      button.addEventListener('click', () => switchSection(button.dataset.section));
    });
    
    // Upload form
    uploadForm.addEventListener('submit', handleUpload);
    
    // Search
    document.getElementById('searchInput').addEventListener('input', handleSearch);
    
    // Invite form
    document.getElementById('inviteForm').addEventListener('submit', handleInvite);
    
    // Close modal on backdrop click
    settingsModal.addEventListener('click', (e) => {
      if (e.target === settingsModal) {
        closeSettings();
      }
    });
  }

  // Handle invite
  async function handleInvite(e) {
    e.preventDefault();
    const email = document.getElementById('inviteEmail').value;
    const message = document.getElementById('inviteMessage').value;
    
    try {
      const response = await fetch('/send-invite', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email, message })
      });
      
      const data = await response.json();
      
      if (response.ok) {
        showStatus('Invitation sent successfully!', 'success', 'inviteStatus');
        document.getElementById('inviteForm').reset();
      } else {
        showStatus(data.error || 'Failed to send invitation', 'error', 'inviteStatus');
      }
    } catch (error) {
      showStatus('Failed to send invitation. Please try again.', 'error', 'inviteStatus');
    }
  }

  // Handle login
  async function handleLogin(e) {
    e.preventDefault();
    const username = document.getElementById('loginUsername').value;
    const password = document.getElementById('loginPassword').value;
    
    try {
      const response = await fetch('/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username, password })
      });
      
      const data = await response.json();
      
      if (response.ok) {
        currentUser = data.user;
        showStatus('Login successful!', 'success', 'authStatus');
        setTimeout(() => {
          showMainApp();
          loadFiles();
          generateInviteLink();
        }, 1000);
      } else {
        showStatus(data.error, 'error', 'authStatus');
      }
    } catch (error) {
      showStatus('Login failed. Please try again.', 'error', 'authStatus');
    }
  }

  // Handle registration
  async function handleRegister(e) {
    e.preventDefault();
    const username = document.getElementById('registerUsername').value;
    const email = document.getElementById('registerEmail').value;
    const password = document.getElementById('registerPassword').value;
    
    try {
      const response = await fetch('/register', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username, email, password })
      });
      
      const data = await response.json();
      
      if (response.ok) {
        showStatus('Registration successful! Please login.', 'success', 'authStatus');
        switchAuthTab('login');
      } else {
        showStatus(data.error, 'error', 'authStatus');
      }
    } catch (error) {
      showStatus('Registration failed. Please try again.', 'error', 'authStatus');
    }
  }

  // Show main app
  function showMainApp() {
    authSection.style.display = 'none';
    mainNav.style.display = 'flex';
    
    // Update user info
    userInfo.innerHTML = `
      <button class="settings-btn" onclick="openSettings()" title="Settings">
        ⚙️
      </button>
      <div class="user-stats">
        📤 ${currentUser.uploads_count} uploads • 📥 ${currentUser.downloads_count} downloads
      </div>
      <span>Welcome, ${currentUser.username}!</span>
      <button class="btn btn-secondary" onclick="logout()">Logout</button>
    `;
    
    // Show browse section by default
    switchSection('browse');
  }

  // Show auth screen
  function showAuthScreen() {
    authSection.style.display = 'block';
    mainNav.style.display = 'none';
    document.querySelectorAll('main section:not(#auth)').forEach(s => s.style.display = 'none');
  }

  // Logout
  async function logout() {
    try {
      await fetch('/logout', { method: 'POST' });
      currentUser = null;
      showAuthScreen();
    } catch (error) {
      console.error('Logout failed:', error);
    }
  }

  // Switch sections
  function switchSection(sectionName) {
    document.querySelectorAll('nav button').forEach(btn => btn.classList.remove('active'));
    document.querySelector(`[data-section="${sectionName}"]`).classList.add('active');
    
    document.querySelectorAll('main section:not(#auth)').forEach(sec => {
      sec.classList.remove('active');
      sec.style.display = 'none';
    });
    
    document.getElementById(sectionName).style.display = 'block';
    document.getElementById(sectionName).classList.add('active');
    
    if (sectionName === 'browse') {
      loadFiles();
    }
  }

  // Load files
  async function loadFiles() {
    try {
      const response = await fetch('/files');
      const data = await response.json();
      allFiles = data.files || [];
      categories = data.categories || [];
      
      updateCategoryFilters();
      populateCategorySelect();
      renderFiles();
    } catch (error) {
      console.error('Failed to load files:', error);
    }
  }

  // Update category filters
  function updateCategoryFilters() {
    const filterContainer = document.querySelector('.category-filter');
    const existingButtons = filterContainer.querySelectorAll('.category-btn:not([data-category="all"])');
    existingButtons.forEach(btn => btn.remove());
    
    categories.forEach(category => {
      const btn = document.createElement('button');
      btn.className = 'category-btn';
      btn.dataset.category = category;
      btn.textContent = category;
      btn.onclick = () => filterByCategory(category);
      filterContainer.appendChild(btn);
    });
  }

  // Populate category select
  function populateCategorySelect() {
    categorySelect.innerHTML = '<option value="">Select a category</option>';
    categories.forEach(category => {
      const option = document.createElement('option');
      option.value = category;
      option.textContent = category;
      categorySelect.appendChild(option);
    });
  }

  // Filter by category
  function filterByCategory(category) {
    currentCategory = category;
    document.querySelectorAll('.category-btn').forEach(btn => btn.classList.remove('active'));
    document.querySelector(`[data-category="${category}"]`).classList.add('active');
    renderFiles();
  }

  // Render files
  function renderFiles(filesToRender = null) {
    const container = filesToRender ? searchResults : fileGrid;
    const files = filesToRender || (currentCategory === 'all' ? allFiles : allFiles.filter(f => f.category === currentCategory));
    
    container.innerHTML = '';
    
    if (files.length === 0) {
      container.innerHTML = `
        <div class="empty-state">
          <div class="icon">📁</div>
          <h3>No files found</h3>
          <p>${filesToRender ? 'Try a different search term' : 'Upload some PDFs to get started!'}</p>
        </div>
      `;
      return;
    }
    
    files.forEach(file => {
      const card = createFileCard(file);
      container.appendChild(card);
    });
  }

  // Create file card
  function createFileCard(file) {
    const card = document.createElement('div');
    card.className = 'file-card';
    
    card.innerHTML = `
      <div class="file-header">
        <div class="file-icon">PDF</div>
        <div class="file-info">
          <h3 title="${file.filename}">${file.original_name}</h3>
          <div class="file-meta">
            ${file.size_mb}MB • ${formatDate(file.upload_date)}<br>
            👤 ${file.uploaded_by} • 📥 ${file.download_count} downloads
          </div>
          <span class="file-category">${file.category}</span>
        </div>
      </div>
      ${file.description ? `<div class="file-description">${file.description}</div>` : ''}
      <div class="file-actions">
        <button class="btn btn-warning" onclick="previewFile('${file.filename}')">Preview</button>
        <button class="btn" onclick="downloadFile('${file.filename}')">Download</button>
        ${file.uploaded_by === currentUser.username ? 
          `<button class="btn btn-danger" onclick="deleteFile('${file.filename}')">Delete</button>` : ''}
      </div>
    `;
    
    return card;
  }

  // Handle upload
  async function handleUpload(e) {
    e.preventDefault();
    const files = document.getElementById('pdfFile').files;
    const category = categorySelect.value;
    const description = document.getElementById('description').value;
    
    if (!files.length || !category) {
      showStatus('Please select file(s) and category.', 'error', 'uploadStatus');
      return;
    }
    
    uploadForm.classList.add('loading');
    progressBar.style.display = 'block';
    
    try {
      let successCount = 0;
      let errorCount = 0;
      
      for (let i = 0; i < files.length; i++) {
        const file = files[i];
        const formData = new FormData();
        formData.append('pdf', file);
        formData.append('category', category);
        formData.append('description', description);
        
        const progress = ((i + 1) / files.length) * 100;
        progressFill.style.width = `${progress}%`;
        
        try {
          const response = await fetch('/upload', {
            method: 'POST',
            body: formData
          });
          
          if (response.ok) {
            successCount++;
          } else {
            errorCount++;
          }
        } catch (error) {
          errorCount++;
        }
      }
      
      if (successCount > 0) {
        showStatus(`Successfully uploaded ${successCount} file(s).`, 'success', 'uploadStatus');
        uploadForm.reset();
        loadFiles();
      } else {
        showStatus('All uploads failed. Please try again.', 'error', 'uploadStatus');
      }
      
    } catch (error) {
      showStatus('Upload failed. Please try again.', 'error', 'uploadStatus');
    } finally {
      uploadForm.classList.remove('loading');
      progressBar.style.display = 'none';
      progressFill.style.width = '0%';
    }
  }

  // Handle search
  function handleSearch(e) {
    const query = e.target.value.trim().toLowerCase();
    
    if (!query) {
      searchResults.innerHTML = `
        <div class="empty-state">
          <div class="icon">🔍</div>
          <h3>Search PDFs</h3>
          <p>Enter keywords to search through the library</p>
        </div>
      `;
      return;
    }
    
    const filtered = allFiles.filter(file => 
      file.original_name.toLowerCase().includes(query) ||
      file.category.toLowerCase().includes(query) ||
      file.description.toLowerCase().includes(query) ||
      file.uploaded_by.toLowerCase().includes(query)
    );
    
    renderFiles(filtered);
  }

  // File actions
  function previewFile(filename) {
    window.open(`/preview/${encodeURIComponent(filename)}`, '_blank');
  }

  async function downloadFile(filename) {
    try {
      const link = document.createElement('a');
      link.href = `/download/${encodeURIComponent(filename)}`;
      link.download = filename;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      
      // Refresh files to update download count
      setTimeout(loadFiles, 1000);
    } catch (error) {
      alert('Download failed. Please make sure you are logged in.');
    }
  }

  async function deleteFile(filename) {
    if (!confirm(`Are you sure you want to delete "${filename}"?`)) {
      return;
    }
    
    try {
      const response = await fetch(`/delete/${encodeURIComponent(filename)}`, {
        method: 'DELETE'
      });
      
      if (response.ok) {
        loadFiles();
      } else {
        const data = await response.json();
        alert(data.error || 'Failed to delete file.');
      }
    } catch (error) {
      alert('Failed to delete file.');
    }
  }

  // Utility functions
  function formatDate(isoString) {
    if (!isoString || isoString === 'Unknown') return 'Unknown';
    const date = new Date(isoString);
    return date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
  }

  function showStatus(message, type, containerId) {
    const container = document.getElementById(containerId);
    container.innerHTML = `<div class="status-message status-${type}">${message}</div>`;
    setTimeout(() => {
      container.innerHTML = '';
    }, 5000);
  }

  // Initialize category filter
  document.querySelector('[data-category="all"]').onclick = () => filterByCategory('all');
</script>
</body>
</html>
